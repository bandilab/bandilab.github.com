<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>bandicoot - specification</title>
    
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/extensions.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      
      
      

      <header>
        <h1 id='bandicoot'>Bandicoot</h1>

<p><a href='/getting-started.html'>Getting Started</a></p>

<p><a href='/specification.html'>Specification</a></p>

<p><a href='/webapps.html'>Webapps</a></p>

<p><a href='/download.html'>Download</a></p>

<p><a href='/blog.html'>Blog</a></p>

<p><a href='/about.html'>About</a></p>
        
        <h4 id='specification'>Specification:</h4>

<p><a href='#language_specification'>Language</a></p>

<p><a href='#relational_operators_and_expressions'>Operators</a></p>

<p><a href='#transactions'>Transactions</a></p>

<p><a href='#api'>API</a></p>
        
      </header>
      <section>
        
        <h1 id='language_specification'>Language Specification</h1>

<h2 id='keywords'> Keywords</h2>

<p>Here are the keywords which are currently in use:</p>
<table>
    <tr>
        <td>extend</td>
        <td>fn</td>
        <td>int</td>
        <td>join</td>
        <td>long</td>
        <td>minus</td>
    </tr>
    <tr>
        <td>project</td>
        <td>real</td>
        <td>rename</td>
        <td>return</td>
        <td>select</td>
        <td>string</td>
    </tr>
    <tr>
        <td>summary</td>
        <td>time</td>
        <td>type</td>
        <td>union</td>
        <td>var</td>
        <td>void</td>
    </tr>
</table>
<p>The <em>time</em> keyword has no meaning at the moment and is reserved for the future release.</p>

<h2 id='program_structure'>Program Structure</h2>

<p>A program is defined in a single source file. The file is evaluated from top to bottom in one pass (similar to the C language). The top-level elements of the program can be of the following types:</p>

<ul>
<li>relational type declarations</li>

<li>relational variable declarations</li>

<li>function declarations</li>
</ul>

<p>The convention for Bandicoot source file extension is <code>.b</code>.</p>

<h2 id='primitive_types'>Primitive Types</h2>

<p>Primitive types are scalar types and are used for attributes within relations, as well as input parameters for functions. There are four types available:</p>
<table>
    <thead>
        <th>Type</th>
        <th>Size</th>
        <th>Description</th>
    </thead>
    <tr>
        <td>int</td>
        <td>32-bit</td>
        <td>signed integer</td>
    </tr>
    <tr>
        <td>long</td>
        <td>64-bit</td>
        <td>signed integer</td>
    </tr>
    <tr>
        <td>real</td>
        <td>64-bit</td>
        <td>IEEE 754 double precision</td>
    </tr>
    <tr>
        <td>string</td>
        <td>0-1024 bytes</td>
        <td>UTF-8 encoded string</td>
    </tr>
</table>
<p>The primitive types are referenced within this specification as <em>PrimitiveType</em>.</p>

<p>Bandicoot is a strongly-typed language and converting a primitive expression of a given type into another type must be explicit. The current version of Bandicoot supports only conversion from one numeric type to another. There is no support for conversion between strings and numbers. The following syntax forms are supported:</p>
<pre>
    (int  <i>PrimitiveExpr</i>)
    (real <i>PrimitiveExpr</i>)
    (long <i>PrimitiveExpr</i>)
</pre>
<h2 id='identifiers'>Identifiers</h2>

<p>Here is the regular expression defining an identifier: <code>[_a-zA-Z0-9]+</code>. Maximum identifier length is 32 characters. Below you will find the following references to the identifiers:</p>

<ul>
<li><em>TypeName</em></li>

<li><em>AttrName</em></li>

<li><em>VarName</em></li>

<li><em>ParamName</em></li>

<li><em>FuncName</em></li>
</ul>

<h2 id='relational_types'> Relational Types</h2>

<p>There are two ways to declare a relational type: named and inline. Named declarations give an identifier to some particular type so that it can be referenced in the code later. Inline (or anonymous) declarations are useful when the type is used only once (e.g. as an input or output function parameter).</p>

<p>Named type can be declared in the following way:</p>
<pre>
type <i>TypeName</i>
{
    <i>AttrName PrimitiveType</i> [,]
    [more attributes]
}
</pre><p>and inline type:</p><pre>
{
    <i>AttrName PrimitiveType</i> [,]
    [more attributes]
}
</pre>
<p>The relational types (both inline and named) are referenced within this specification as <em>RelType</em>.</p>

<h2 id='relational_variables'> Relational Variables</h2>

<p>Relational variables are used for keeping the program state. The system provides two types of variables:</p>

<ul>
<li>global variables</li>

<li>local (temporary) variables</li>
</ul>

<p>Here is how you can declare a global variable named <em>VarName</em>.</p>
<pre>
var <i>VarName RelType</i> ;
</pre>
<p>The relational variables are referenced within this specification as <em>RelVar</em>.</p>

<h2 id='functions'>Functions</h2>

<p>Functions are identified by names which must be unique across the whole program source file. A function can make complex state transformations on top of the global variables (see <a href='#transactions'>Transactions</a> section).</p>
<pre>
fn <i>FuncName</i> ( <i>FuncArgs</i> ) <i>FuncReturn</i>
{
    <i>FuncBody</i>
}
</pre>
<p><em>FuncArgs</em> can be contain only one relational argument and and several arguments of a primitive type all separated with the commas. Each argument has the following structure:</p>
<pre>
<i>ArgName</i> &quot;<i>RelType</i> | <i>PrimitiveType</i>&quot;
</pre>
<p>The <em>FuncReturn</em> defines the result type of a function. It can either be a relational type or no result at all, identified by keyword <em>void</em>:</p>
<pre>
<i>RelType</i> | <i>void</i>
</pre>
<p>Function body (_FuncBody_) is a list of statements evaluated from top to bottom. The list is separated with the semicolons (&#34;;&#34;). Statements can be of three types:</p>

<ul>
<li>global variable assignment <pre>
<i>VarName</i> = <i>RelExpr</i> ;
</pre></li>

<li>temporary variable declaration and assignment <pre>
var <i>VarName</i> = <i>RelExpr</i> ;
</pre></li>

<li>return statement (only if a function declares its output type) <pre>
return <i>RelExpr</i> ;
</pre></li>
</ul>

<p>A function cannot call another function. Also, only one assignment per global relational variable is possible within a function body. After the assignment the global variable cannot be accessed anymore (within the same function). This is a temporary limitation and you can workaround it with the help of temporary variables.</p>

<h2 id='relational_operators_and_expressions'> Relational Operators and Expressions</h2>

<p>Bandicoot implements 8 <a href='bandicoot-algebra.pdf'>relational operators</a> which provide rich data manipulative features. Some of the operators are <em>binary</em> (take 2 relations as input) and some are <em>unary</em> (take 1 relation as input). Apart from the relational inputs these operators usually take additional argument specific to the operator. Every operator returns a new relation and does not modify the inputs. The language provides these operators as functions with arguments:</p>
<pre>
<i>OperatorName</i> (<i>arg1</i>) (<i>arg2</i>) ... (<i>argN</i>)
</pre>
<p>The brackets around the arguments are mandatory only if the argument is an operator with at least one argument.</p>

<p>Every relational variable (global or local) is an operator as well and returns the value of the variable. The operators are the main building blocks in the language. Complex relational expressions (_RelExpr_) can be created by nesting the relational operators to compute the desired results.</p>

<h3 id='rename'>Rename</h3>
<pre>
rename <i>ToAttrName</i> = <i>FromAttrName</i> [,] [more attributes] <i>RelExpr</i> 
</pre>
<p>This operator creates a new relation with the specified attributes being renames, the relational body (tuples) does not change.</p>

<h3 id='project'> Project</h3>
<pre>
project <i>AttrName</i> [,] [more attributes] <i>RelExpr</i>
</pre>
<p>The result contains only the attributes defined as the first argument. It can have reduced number of tuples due to removal of duplicate values.</p>

<p><img src='diagram-project.png' alt='project' /></p>

<h3 id='extend'> Extend</h3>
<pre>
extend <i>AttrName</i> = <i>PrimitiveExpr</i> [,] [more attributes] <i>RelExpr</i>
</pre>
<p>The operator adds the attributes defined as the first argument to each tuple of the input relation. The values are computed by primitive expressions.</p>

<p><img src='diagram-extend.png' alt='extend' /></p>

<h3 id='select'>Select</h3>
<pre>
select <i>BooleanExpr</i> <i>RelExpr</i> 
</pre>
<p>The result contains only those tuples of the input relation which match the boolean expression defined as the first argument.</p>

<p><img src='diagram-select.png' alt='select' /></p>

<h3 id='union'>Union</h3>
<pre>
union <i>RelExpr</i> <i>RelExpr</i>
</pre>
<p>or</p>
<pre>
<i>RelExpr</i> + <i>RelExpr</i>
</pre>
<p>The union operator creates a new relation consisting of two input relations removing duplicate tuples. Both inputs need to have the same attributes.</p>

<p><img src='diagram-union.png' alt='union' /></p>

<h3 id='minus_semidifference'>Minus (Semidifference)</h3>
<pre>
minus <i>RelExpr</i> <i>RelExpr</i>
</pre>
<p>or</p>
<pre>
<i>RelExpr</i> - <i>RelExpr</i>
</pre>
<p>Removes tuples from the first input which match tuples in the second input. The matching logic is an equality on the common attributes.</p>

<p><img src='diagram-minus.png' alt='minus' /></p>

<h3 id='natural_join'> Natural Join</h3>
<pre>
join <i>RelExpr</i> <i>RelExpr</i>
</pre>
<p>or</p>
<pre>
<i>RelExpr</i> * <i>RelExpr</i>
</pre>
<p>This operator creates a result where the tuples are combinations of matching tuples from both input relations. The matching logic is an equality on the common attributes. If there are no common attributes the result is a cartesian join (i.e. every tuple from the first input matches every tuple in the second input). All the attributes from the input relations are present in the result.</p>

<p><img src='diagram-join.png' alt='join' /></p>

<h3 id='summary'>Summary</h3>

<h4 id='unary_version'>Unary version</h4>
<pre>
summary <i>AttrName</i> = <i>SumFunc</i> [,] [more attributes] <i>RelExpr</i>
</pre>
<h4 id='binary_version'> Binary version</h4>
<pre>
summary <i>AttrName</i> = <i>SumFunc</i> [,] [more attributes] <i>RelExpr</i> <i>RelExpr</i>
</pre>
<p>Both unary and binary versions of summary operator produce tuples containing summary data grouped according to the specified attributes. In case of the unary version, the grouping is done by a virtual relation with zero attributes and therefore the result contains up to one tuple. The binary version creates the groups according to all the attributes of the second relation.</p>

<p><img src='diagram-summary.png' alt='summary' /></p>

<p>Result type is expressed as an extension of the empty relation (unary summary) or rightmost relation (binary summary). Each attribute can be of a specified summary function (_SumFunc_). Here is a list of currently supported functions:</p>

<ul>
<li>add - sum up the values of an attribute <pre>
(add <i>AttrName</i> <i>DefVal</i>)
</pre></li>

<li>avg - average of values of an attribute <pre>
(avg <i>AttrName</i> <i>DefVal</i>)
</pre></li>

<li>cnt - count the number of tuples <pre>
(cnt)
</pre></li>

<li>max - maximum value of an attribute <pre>
(max <i>AttrName</i> <i>DefVal</i>)
</pre></li>

<li>min - minimum value of an attribute <pre>
(min <i>AttrName</i> <i>DefVal</i>)
</pre></li>
</ul>

<p>Where <em>DefVal</em> is a constant expression. The type of the expression should match the type of the result and attribute. The exception is the <em>avg</em> function where the default value and result are always real numbers. <em>DefVal</em> is used in those cases when the <em>RelExpr</em> body is empty. In case of the binary summary this can happen when there is no matching tuple in left <em>RelExpr</em> for a tuple in the right <em>RelExpr</em>.</p>

<h1 id='transactions'> Transactions</h1>

<p>Each invocation of a function implicitly creates a transaction. All the statements within a function are part of the same transaction. There are no explicit keywords to commit or rollback a transaction. If there is an error the rollback is performed automatically and an error code is returned to the client.</p>

<p>Modification of a global variable is not allowed by two transactions at the same time. Therefore two functions which modify the same variable are serialized and executed one after the other. Read-only functions are executed in parallel with other read/write functions.</p>

<p>The level of isolation is always serializable and it means that if a read of the same variable occurs several times within a function it always returns the same data even if the variable is modified by a different function at the same time.</p>

<h1 id='api'> API</h1>

<p>Bandicoot API is based on the HTTP/1.1 protocol. The interface exposes all the functions defined in a program source file through <code>http://server:port/FuncName</code> URLs. The HTTP POST method must be used to invoke a function with an input parameter. Otherwise the HTTP GET is required.</p>

<p>Both input and output parameters are exchanged in &#34;comma separated values&#34; format. The tuples are delimited with the <code>\n</code> end-of-line character. The first line is a relational head definition in the following format:</p>
<pre>
    <i>AttrName PrimitiveType</i> [,][more attributes]
</pre>
<p>The comma or the end-of-line character can be escaped by using <code>\</code> character. It means the Bandicoot will not represent those characters and they will be treated as part of your data.</p>
      </section>
      <footer><p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
<p><small>&copy; 2012 bandilab.org</small></p>
</footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
  </body>
</html>
