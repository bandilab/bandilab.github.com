<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>bandicoot - webapps</title>
    
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/extensions.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      
      
      

      <header>
        <h1 id='bandicoot'>Bandicoot</h1>

<p><a href='/getting-started.html'>Getting Started</a></p>

<p><a href='/specification.html'>Specification</a></p>

<p><a href='/webapps.html'>Webapps</a></p>

<p><a href='/download.html'>Download</a></p>

<p><a href='/blog.html'>Blog</a></p>

<p><a href='/about.html'>About</a></p>
        
      </header>
      <section>
        
        <p>Connect your browser directly to the Bandicoot! Here you will find instructions on how to make it and a public domain JavaScript API. If something is not entirely clear below refer to the <a href='getting-started.html'>getting started</a> or <a href='specification.html'>specification</a> pages.</p>

<p>All of the examples/files mentioned below are packed together with the Bandicoot <a href='download.html'>binaries</a>. If you build the system from Git you will need to download the examples as a separate <a href='examples.tgz'>package</a>.</p>

<h2 id='basics'>Â Basics</h2>

<p>Returning unique integer numbers (refer to the unique.html and unique.b in the examples package).</p>

<pre><code>fn Unique(vals {x int}) {x int}
{
    return vals;
}</code></pre>

<p>This function is exposed via the following URL: <code>http://host:port/Unique</code>. To call it from the JavaScript you can issue an HTTP POST using the XMLHttpRequest object available in most browsers these days. Here is the JavaScript fragment from the unique.html which executes the Unique function with the hard-coded input parameters (the csv variable).</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>var</span> <span class='nx'>csv</span> <span class='o'>=</span> <span class='s2'>&quot;x int\n1\n2\n1\n2\n3&quot;</span><span class='p'>;</span>

<span class='kd'>var</span> <span class='nx'>req</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>XMLHttpRequest</span><span class='p'>();</span>
<span class='nx'>req</span><span class='p'>.</span><span class='nx'>open</span><span class='p'>(</span><span class='s2'>&quot;POST&quot;</span><span class='p'>,</span> <span class='s2'>&quot;http://localhost:12345/Unique&quot;</span><span class='p'>,</span> <span class='kc'>false</span><span class='p'>);</span>
<span class='nx'>req</span><span class='p'>.</span><span class='nx'>send</span><span class='p'>(</span><span class='nx'>csv</span><span class='p'>);</span>

<span class='k'>if</span> <span class='p'>(</span><span class='nx'>req</span><span class='p'>.</span><span class='nx'>status</span> <span class='o'>==</span> <span class='mi'>200</span><span class='p'>)</span>
    <span class='nx'>confirm</span><span class='p'>(</span><span class='nx'>req</span><span class='p'>.</span><span class='nx'>responseText</span><span class='p'>);</span>
<span class='k'>else</span>
    <span class='k'>throw</span> <span class='s2'>&quot;status: &quot;</span> <span class='o'>+</span> <span class='nx'>req</span><span class='p'>.</span><span class='nx'>status</span><span class='p'>;</span>
</code></pre>
</div>
<p>Bandicoot supports the Cross-Origin Resource Sharing (CORS) specification which makes it easy to develop your web applications on a local computer. You will need a modern web browser such as Firefox 3.5, Safari 3, or Google Chrome. If you cannot install one of these browsers you can setup an HTTP server and configure a proxy so that both the web page and the Bandicoot are available via a single domain.</p>

<h2 id='relationjs'>relation.js</h2>

<p>For a more sophisticated program you will need some facility which can parse the Bandicoot output (CSV). We have created an API which you can use in your applications:</p>

<ul>
<li>construct a new Rel object from the Bandicoot output: <pre>var rel = new Rel("greeting string\nHello!\nBonjour!\nGruezi!");</pre></li>

<li>get the next tuple (returns a map of attribute names to values): <pre>for (var tuple = rel.next(); tuple != null; tuple = rel.next())
  alert(tuple["greeting"]);</pre></li>

<li>reset the object so that you can iterate through the tuples again: <pre>rel.reset();</pre></li>

<li>get the values based on the index (you can pass any argument to the next call) <pre>for (var tuple = rel.next(1); tuple != null; tuple = rel.next(1))
  alert(tuple[0]);</pre></li>
</ul>

<p>Here is the relation.js:</p>
<div class='highlight'><pre><code class='javascript'><span class='kd'>function</span> <span class='nx'>Rel</span><span class='p'>(</span><span class='nx'>csv</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span> <span class='o'>=</span> <span class='nx'>split</span><span class='p'>(</span><span class='nx'>csv</span><span class='p'>,</span> <span class='s2'>&quot;\n&quot;</span><span class='p'>);</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>head</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nx'>Head</span><span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span><span class='p'>[</span><span class='mi'>0</span><span class='p'>]);</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span> <span class='o'>=</span> <span class='mi'>1</span><span class='p'>;</span>

    <span class='k'>this</span><span class='p'>.</span><span class='nx'>next</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>returnTupleAsArray</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span> <span class='o'>&gt;=</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>||</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span><span class='p'>[</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span><span class='p'>]</span> <span class='o'>==</span> <span class='s2'>&quot;&quot;</span><span class='p'>)</span>
            <span class='k'>return</span> <span class='kc'>null</span><span class='p'>;</span>

        <span class='kd'>var</span> <span class='nx'>attrs</span> <span class='o'>=</span> <span class='nx'>split</span><span class='p'>(</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span><span class='p'>[</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span><span class='p'>],</span> <span class='s2'>&quot;,&quot;</span><span class='p'>);</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='nx'>attrs</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>!=</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>head</span><span class='p'>.</span><span class='nx'>len</span><span class='p'>)</span>
            <span class='k'>throw</span> <span class='s2'>&quot;bad tuple [&quot;</span> <span class='o'>+</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span><span class='p'>[</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span><span class='p'>]</span> <span class='o'>+</span> <span class='s2'>&quot;]&quot;</span><span class='p'>;</span>

        <span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span><span class='o'>++</span><span class='p'>;</span>

        <span class='kd'>var</span> <span class='nx'>res</span> <span class='o'>=</span> <span class='nx'>attrs</span><span class='p'>;</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='nx'>returnTupleAsArray</span> <span class='o'>===</span> <span class='kc'>undefined</span><span class='p'>)</span> <span class='p'>{</span>
            <span class='nx'>res</span> <span class='o'>=</span> <span class='p'>[];</span>
            <span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span> <span class='nx'>i</span> <span class='o'>&lt;</span> <span class='nx'>attrs</span><span class='p'>.</span><span class='nx'>length</span><span class='p'>;</span> <span class='o'>++</span><span class='nx'>i</span><span class='p'>)</span>
                <span class='nx'>res</span><span class='p'>[</span><span class='k'>this</span><span class='p'>.</span><span class='nx'>head</span><span class='p'>.</span><span class='nx'>names</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>]]</span> <span class='o'>=</span> <span class='nx'>attrs</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>];</span>
        <span class='p'>}</span>

        <span class='k'>return</span> <span class='nx'>res</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='k'>this</span><span class='p'>.</span><span class='nx'>reset</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
        <span class='k'>this</span><span class='p'>.</span><span class='nx'>pos</span> <span class='o'>=</span> <span class='mi'>1</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='k'>this</span><span class='p'>.</span><span class='nx'>count</span> <span class='o'>=</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
        <span class='k'>return</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>lines</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>-</span> <span class='mi'>1</span><span class='p'>;</span>
    <span class='p'>}</span>
<span class='p'>}</span>

<span class='kd'>function</span> <span class='nx'>Head</span><span class='p'>(</span><span class='nx'>line</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>namesTypes</span> <span class='o'>=</span> <span class='nx'>split</span><span class='p'>(</span><span class='nx'>line</span><span class='p'>,</span> <span class='s2'>&quot;,&quot;</span><span class='p'>);</span>

    <span class='k'>this</span><span class='p'>.</span><span class='nx'>len</span> <span class='o'>=</span> <span class='nx'>namesTypes</span><span class='p'>.</span><span class='nx'>length</span><span class='p'>;</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>attrs</span> <span class='o'>=</span> <span class='p'>[];</span>
    <span class='k'>this</span><span class='p'>.</span><span class='nx'>names</span> <span class='o'>=</span> <span class='p'>[];</span>

    <span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span> <span class='nx'>i</span> <span class='o'>&lt;</span> <span class='k'>this</span><span class='p'>.</span><span class='nx'>len</span><span class='p'>;</span> <span class='o'>++</span><span class='nx'>i</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='kd'>var</span> <span class='nx'>nt</span> <span class='o'>=</span> <span class='nx'>split</span><span class='p'>(</span><span class='nx'>namesTypes</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>],</span> <span class='s2'>&quot; &quot;</span><span class='p'>);</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='nx'>nt</span><span class='p'>.</span><span class='nx'>length</span> <span class='o'>!=</span> <span class='mi'>2</span><span class='p'>)</span>
            <span class='k'>throw</span> <span class='s2'>&quot;bad head attribute [&quot;</span> <span class='o'>+</span> <span class='nx'>namesTypes</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>]</span> <span class='o'>+</span> <span class='s2'>&quot;]&quot;</span><span class='p'>;</span>

        <span class='k'>this</span><span class='p'>.</span><span class='nx'>attrs</span><span class='p'>[</span><span class='nx'>nt</span><span class='p'>[</span><span class='mi'>0</span><span class='p'>]]</span> <span class='o'>=</span> <span class='nx'>nt</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>];</span>
        <span class='k'>this</span><span class='p'>.</span><span class='nx'>names</span><span class='p'>[</span><span class='nx'>i</span><span class='p'>]</span> <span class='o'>=</span> <span class='nx'>nt</span><span class='p'>[</span><span class='mi'>0</span><span class='p'>];</span>
    <span class='p'>}</span>
<span class='p'>}</span>

<span class='kd'>function</span> <span class='nx'>split</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>,</span> <span class='nx'>delim</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kd'>var</span> <span class='nx'>res</span> <span class='o'>=</span> <span class='p'>[],</span> <span class='nx'>line</span> <span class='o'>=</span> <span class='p'>[];</span>
    <span class='kd'>var</span> <span class='nx'>esc</span> <span class='o'>=</span> <span class='s2'>&quot;\\&quot;</span><span class='p'>,</span> <span class='nx'>prev</span> <span class='o'>=</span> <span class='s2'>&quot; &quot;</span><span class='p'>;</span>
    <span class='kd'>var</span> <span class='nx'>len</span> <span class='o'>=</span> <span class='nx'>data</span><span class='p'>.</span><span class='nx'>length</span><span class='p'>;</span>
    <span class='kd'>var</span> <span class='nx'>parts</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>,</span> <span class='nx'>idx</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span>

    <span class='k'>for</span> <span class='p'>(</span><span class='kd'>var</span> <span class='nx'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span> <span class='nx'>i</span> <span class='o'>&lt;</span> <span class='nx'>len</span><span class='p'>;</span> <span class='o'>++</span><span class='nx'>i</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='kd'>var</span> <span class='nx'>c</span> <span class='o'>=</span> <span class='nx'>data</span><span class='p'>.</span><span class='nx'>charAt</span><span class='p'>(</span><span class='nx'>i</span><span class='p'>);</span>

        <span class='k'>if</span> <span class='p'>(</span><span class='nx'>c</span> <span class='o'>!=</span> <span class='nx'>delim</span> <span class='o'>||</span> <span class='nx'>prev</span> <span class='o'>==</span> <span class='nx'>esc</span><span class='p'>)</span>
            <span class='nx'>line</span><span class='p'>[</span><span class='nx'>idx</span><span class='o'>++</span><span class='p'>]</span> <span class='o'>=</span> <span class='nx'>c</span><span class='p'>;</span>

        <span class='k'>if</span> <span class='p'>((</span><span class='nx'>c</span> <span class='o'>==</span> <span class='nx'>delim</span> <span class='o'>&amp;&amp;</span> <span class='p'>(</span><span class='nx'>prev</span> <span class='o'>!=</span> <span class='nx'>esc</span><span class='p'>))</span> <span class='o'>||</span> <span class='p'>(</span><span class='nx'>i</span> <span class='o'>+</span> <span class='mi'>1</span><span class='p'>)</span> <span class='o'>==</span> <span class='nx'>len</span><span class='p'>)</span> <span class='p'>{</span>
            <span class='nx'>res</span><span class='p'>[</span><span class='nx'>parts</span><span class='o'>++</span><span class='p'>]</span> <span class='o'>=</span> <span class='nx'>line</span><span class='p'>.</span><span class='nx'>join</span><span class='p'>(</span><span class='s2'>&quot;&quot;</span><span class='p'>);</span>
            <span class='nx'>line</span> <span class='o'>=</span> <span class='p'>[];</span>
            <span class='nx'>idx</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>;</span>
        <span class='p'>}</span>

        <span class='nx'>prev</span> <span class='o'>=</span> <span class='p'>(</span><span class='nx'>prev</span> <span class='o'>==</span> <span class='nx'>esc</span><span class='p'>)</span> <span class='o'>?</span> <span class='s2'>&quot; &quot;</span> <span class='o'>:</span> <span class='nx'>c</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='k'>return</span> <span class='nx'>res</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre>
</div>
<p>For a complete example see total.html and total.b. The program dynamically constructs a request from the input fields, then calls the Total function, and finally parses the output with the relation.js facility and displays the results.</p>
      </section>
      <footer><p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
<p><small>&copy; 2012 bandilab.org</small></p>
</footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
  </body>
</html>
